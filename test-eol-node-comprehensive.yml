# Comprehensive EOL Node.js Feature Test Pipeline
# Tests real Azure DevOps tasks with different Node.js handler configurations
# Each job tests specific knob combinations with actual tasks

trigger:
  branches:
    include:
    - users/rishabhmalikMS/agentEOLNodeUpdates
    - main

variables:
  BUILD_CONFIGURATION: 'Debug'

pool: 
  name: 'YourSelfHostedPool'

stages:
- stage: 'EOL_Node_Feature_Testing'
  displayName: 'EOL Node.js Feature Testing with Real Tasks'

  jobs:

  # =============================================================================
  # NODE6 HANDLER TESTS
  # =============================================================================
  
  - job: 'Node6_Handler_Tests'
    displayName: 'Node6 Handler Tests'
    strategy:
      matrix:
        Node6_EOL_Policy_Enabled:
          TEST_NAME: 'Node6_With_EOL_Policy_Enabled'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
          EXPECTED_BEHAVIOR: 'Should upgrade to Node24'
          
        Node6_EOL_Policy_Disabled:
          TEST_NAME: 'Node6_With_EOL_Policy_Disabled'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'false'
          EXPECTED_BEHAVIOR: 'Should use Node6'
          
        Node6_With_Global_Node24:
          TEST_NAME: 'Node6_With_Global_Node24_Knob'
          AGENT_USE_NODE24: 'true'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
          EXPECTED_BEHAVIOR: 'Should use Node24 due to global knob'

    steps:
    - task: PowerShell@2
      displayName: 'Test Setup: $(TEST_NAME)'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== $(TEST_NAME) ===" -ForegroundColor Cyan
          Write-Host "Expected Behavior: $(EXPECTED_BEHAVIOR)" -ForegroundColor Yellow
          
          # Set environment variables based on test matrix
          if ("$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)" -ne '') {
              $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY = "$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)"
              Write-Host "Set AGENT_ENABLE_EOL_NODE_VERSION_POLICY = $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY" -ForegroundColor Green
          }
          if ("$(AGENT_USE_NODE24)" -ne '') {
              $env:AGENT_USE_NODE24 = "$(AGENT_USE_NODE24)"
              Write-Host "Set AGENT_USE_NODE24 = $env:AGENT_USE_NODE24" -ForegroundColor Green
          }

    # Create a task definition that would use Node6 handler
    - task: PowerShell@2
      displayName: 'Create Node6 Task Definition'
      inputs:
        targetType: 'inline'
        script: |
          # Create a task.json that specifies Node6 handler
          $taskJson = @{
              "id" = "test-node6-task"
              "name" = "TestNode6Task"
              "friendlyName" = "Test Node6 Task"
              "description" = "Test task that uses Node6 handler"
              "category" = "Utility"
              "version" = @{
                  "Major" = 1
                  "Minor" = 0
                  "Patch" = 0
              }
              "execution" = @{
                  "Node" = @{
                      "target" = "test-node6-script.js"
                  }
              }
          }
          
          # Create task script
          $taskScript = @"
          console.log('=== Node6 Handler Test ===');
          console.log('Node version:', process.version);
          console.log('Node executable path:', process.execPath);
          console.log('Process ID:', process.pid);
          console.log('Architecture:', process.arch);
          console.log('Platform:', process.platform);
          console.log('Test: $(TEST_NAME)');
          console.log('Expected: $(EXPECTED_BEHAVIOR)');
          "@
          
          # Create temporary task directory
          $taskDir = "$(Agent.TempDirectory)/TestNode6Task"
          New-Item -ItemType Directory -Path $taskDir -Force | Out-Null
          
          # Write task files
          $taskJson | ConvertTo-Json -Depth 10 | Out-File -FilePath "$taskDir/task.json" -Encoding UTF8
          $taskScript | Out-File -FilePath "$taskDir/test-node6-script.js" -Encoding UTF8
          
          Write-Host "Created Node6 test task at: $taskDir"

    # Execute the Node6 task (this will trigger the node handler selection logic)
    - task: PowerShell@2
      displayName: 'Execute Node6 Task'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "Executing Node6 task to test handler selection..." -ForegroundColor Yellow
          
          $taskDir = "$(Agent.TempDirectory)/TestNode6Task"
          $scriptPath = "$taskDir/test-node6-script.js"
          
          # Execute the Node.js script - this will use the agent's node selection logic
          Write-Host "Executing: node $scriptPath" -ForegroundColor Gray
          node $scriptPath
          
          Write-Host "Node6 handler test completed for: $(TEST_NAME)" -ForegroundColor Green

  # =============================================================================
  # NODE16 HANDLER TESTS
  # =============================================================================
  
  - job: 'Node16_Handler_Tests'
    displayName: 'Node16 Handler Tests'
    strategy:
      matrix:
        Node16_EOL_Policy_Enabled:
          TEST_NAME: 'Node16_With_EOL_Policy_Enabled'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
          EXPECTED_BEHAVIOR: 'Should upgrade to Node24'
          
        Node16_EOL_Policy_Disabled:
          TEST_NAME: 'Node16_With_EOL_Policy_Disabled'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'false'
          EXPECTED_BEHAVIOR: 'Should use Node16'

    steps:
    - task: PowerShell@2
      displayName: 'Test Setup: $(TEST_NAME)'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== $(TEST_NAME) ===" -ForegroundColor Cyan
          Write-Host "Expected Behavior: $(EXPECTED_BEHAVIOR)" -ForegroundColor Yellow
          
          if ("$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)" -ne '') {
              $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY = "$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)"
              Write-Host "Set AGENT_ENABLE_EOL_NODE_VERSION_POLICY = $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY" -ForegroundColor Green
          }

    - task: PowerShell@2
      displayName: 'Create Node16 Task Definition'
      inputs:
        targetType: 'inline'
        script: |
          # Create task.json for Node16 handler
          $taskJson = @{
              "execution" = @{
                  "Node16" = @{
                      "target" = "test-node16-script.js"
                  }
              }
          }
          
          $taskScript = @"
          console.log('=== Node16 Handler Test ===');
          console.log('Node version:', process.version);
          console.log('Node executable path:', process.execPath);
          console.log('Test: $(TEST_NAME)');
          console.log('Expected: $(EXPECTED_BEHAVIOR)');
          "@
          
          $taskDir = "$(Agent.TempDirectory)/TestNode16Task"
          New-Item -ItemType Directory -Path $taskDir -Force | Out-Null
          
          $taskJson | ConvertTo-Json -Depth 10 | Out-File -FilePath "$taskDir/task.json" -Encoding UTF8
          $taskScript | Out-File -FilePath "$taskDir/test-node16-script.js" -Encoding UTF8
          
          Write-Host "Created Node16 test task"

    - task: PowerShell@2
      displayName: 'Execute Node16 Task'
      inputs:
        targetType: 'inline'
        script: |
          $scriptPath = "$(Agent.TempDirectory)/TestNode16Task/test-node16-script.js"
          Write-Host "Executing Node16 task..." -ForegroundColor Yellow
          node $scriptPath
          Write-Host "Node16 handler test completed." -ForegroundColor Green

  # =============================================================================
  # NODE20 HANDLER TESTS  
  # =============================================================================
  
  - job: 'Node20_Handler_Tests'
    displayName: 'Node20 Handler Tests (Should Not Be Affected by EOL)'
    strategy:
      matrix:
        Node20_With_EOL_Policy:
          TEST_NAME: 'Node20_With_EOL_Policy_Should_Not_Be_Affected'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
          EXPECTED_BEHAVIOR: 'Should use Node20 (not EOL)'

    steps:
    - task: PowerShell@2
      displayName: 'Test Setup: $(TEST_NAME)'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== $(TEST_NAME) ===" -ForegroundColor Cyan
          Write-Host "Expected Behavior: $(EXPECTED_BEHAVIOR)" -ForegroundColor Yellow
          
          $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY = "$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)"
          Write-Host "Set AGENT_ENABLE_EOL_NODE_VERSION_POLICY = $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY" -ForegroundColor Green

    - task: PowerShell@2
      displayName: 'Create Node20 Task Definition'
      inputs:
        targetType: 'inline'
        script: |
          $taskJson = @{
              "execution" = @{
                  "Node20_1" = @{
                      "target" = "test-node20-script.js"
                  }
              }
          }
          
          $taskScript = @"
          console.log('=== Node20 Handler Test ===');
          console.log('Node version:', process.version);
          console.log('Node executable path:', process.execPath);
          console.log('Test: $(TEST_NAME)');
          console.log('Expected: $(EXPECTED_BEHAVIOR)');
          "@
          
          $taskDir = "$(Agent.TempDirectory)/TestNode20Task"
          New-Item -ItemType Directory -Path $taskDir -Force | Out-Null
          
          $taskJson | ConvertTo-Json -Depth 10 | Out-File -FilePath "$taskDir/task.json" -Encoding UTF8
          $taskScript | Out-File -FilePath "$taskDir/test-node20-script.js" -Encoding UTF8

    - task: PowerShell@2
      displayName: 'Execute Node20 Task'
      inputs:
        targetType: 'inline'
        script: |
          $scriptPath = "$(Agent.TempDirectory)/TestNode20Task/test-node20-script.js"
          Write-Host "Executing Node20 task..." -ForegroundColor Yellow
          node $scriptPath
          Write-Host "Node20 handler test completed." -ForegroundColor Green

  # =============================================================================
  # GLOBAL KNOB OVERRIDE TESTS
  # =============================================================================
  
  - job: 'Global_Knob_Tests'
    displayName: 'Global Knob Override Tests'
    strategy:
      matrix:
        UseNode24_Global_Override:
          TEST_NAME: 'Global_AGENT_USE_NODE24_Override'
          AGENT_USE_NODE24: 'true'
          HANDLER_TYPE: 'Node6'
          EXPECTED_BEHAVIOR: 'Any task should use Node24'
          
        UseNode20_Global_Override:
          TEST_NAME: 'Global_AGENT_USE_NODE20_1_Override'
          AGENT_USE_NODE20_1: 'true'
          HANDLER_TYPE: 'Node16'
          EXPECTED_BEHAVIOR: 'Any task should use Node20.1'
          
        Multiple_Knobs_Priority_Test:
          TEST_NAME: 'Multiple_Global_Knobs_Priority'
          AGENT_USE_NODE24: 'true'
          AGENT_USE_NODE20_1: 'true'
          HANDLER_TYPE: 'Node6'
          EXPECTED_BEHAVIOR: 'Node24 should win (highest priority)'

    steps:
    - task: PowerShell@2
      displayName: 'Setup Global Knob Test: $(TEST_NAME)'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== $(TEST_NAME) ===" -ForegroundColor Cyan
          Write-Host "Handler Type: $(HANDLER_TYPE)" -ForegroundColor Yellow
          Write-Host "Expected Behavior: $(EXPECTED_BEHAVIOR)" -ForegroundColor Yellow
          
          # Set global knobs based on test matrix
          if ("$(AGENT_USE_NODE24)" -ne '') {
              $env:AGENT_USE_NODE24 = "$(AGENT_USE_NODE24)"
              Write-Host "Set AGENT_USE_NODE24 = $env:AGENT_USE_NODE24" -ForegroundColor Green
          }
          if ("$(AGENT_USE_NODE20_1)" -ne '') {
              $env:AGENT_USE_NODE20_1 = "$(AGENT_USE_NODE20_1)"
              Write-Host "Set AGENT_USE_NODE20_1 = $env:AGENT_USE_NODE20_1" -ForegroundColor Green
          }

    - task: PowerShell@2
      displayName: 'Create Test Task with $(HANDLER_TYPE) Handler'
      inputs:
        targetType: 'inline'
        script: |
          # Create task with specified handler type
          $execution = @{}
          switch ("$(HANDLER_TYPE)") {
              "Node6" { $execution["Node"] = @{ "target" = "test-script.js" } }
              "Node16" { $execution["Node16"] = @{ "target" = "test-script.js" } }
              "Node20" { $execution["Node20_1"] = @{ "target" = "test-script.js" } }
          }
          
          $taskJson = @{
              "execution" = $execution
          }
          
          $taskScript = @"
          console.log('=== Global Knob Test ===');
          console.log('Handler Type: $(HANDLER_TYPE)');
          console.log('Node version:', process.version);
          console.log('Node executable path:', process.execPath);
          console.log('Test: $(TEST_NAME)');
          console.log('Expected: $(EXPECTED_BEHAVIOR)');
          "@
          
          $taskDir = "$(Agent.TempDirectory)/TestGlobalKnob"
          New-Item -ItemType Directory -Path $taskDir -Force | Out-Null
          
          $taskJson | ConvertTo-Json -Depth 10 | Out-File -FilePath "$taskDir/task.json" -Encoding UTF8
          $taskScript | Out-File -FilePath "$taskDir/test-script.js" -Encoding UTF8

    - task: PowerShell@2
      displayName: 'Execute Global Knob Test'
      inputs:
        targetType: 'inline'
        script: |
          $scriptPath = "$(Agent.TempDirectory)/TestGlobalKnob/test-script.js"
          Write-Host "Executing task with global knob settings..." -ForegroundColor Yellow
          node $scriptPath
          Write-Host "Global knob test completed: $(TEST_NAME)" -ForegroundColor Green

  # =============================================================================
  # CUSTOM NODE PATH TESTS
  # =============================================================================
  
  - job: 'Custom_Node_Path_Tests'
    displayName: 'Custom Node Path Tests'
    strategy:
      matrix:
        CustomPath_Override_Everything:
          TEST_NAME: 'Custom_Node_Path_Override'
          AGENT_USE_NODE_PATH: '/custom/node/path'
          AGENT_USE_NODE24: 'true'
          AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
          EXPECTED_BEHAVIOR: 'Should try custom path first (highest priority)'

    steps:
    - task: PowerShell@2
      displayName: 'Setup Custom Path Test: $(TEST_NAME)'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== $(TEST_NAME) ===" -ForegroundColor Cyan
          Write-Host "Expected Behavior: $(EXPECTED_BEHAVIOR)" -ForegroundColor Yellow
          
          # Set custom path and other variables
          $env:AGENT_USE_NODE_PATH = "$(AGENT_USE_NODE_PATH)"
          $env:AGENT_USE_NODE24 = "$(AGENT_USE_NODE24)"
          $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY = "$(AGENT_ENABLE_EOL_NODE_VERSION_POLICY)"
          
          Write-Host "Set AGENT_USE_NODE_PATH = $env:AGENT_USE_NODE_PATH" -ForegroundColor Green
          Write-Host "Set AGENT_USE_NODE24 = $env:AGENT_USE_NODE24 (should be ignored)" -ForegroundColor Gray
          Write-Host "Set EOL Policy = $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY (should be ignored)" -ForegroundColor Gray

    - task: PowerShell@2
      displayName: 'Create Custom Path Test Task'
      inputs:
        targetType: 'inline'
        script: |
          $taskScript = @"
          console.log('=== Custom Node Path Test ===');
          console.log('Node version:', process.version);
          console.log('Node executable path:', process.execPath);
          console.log('Test: $(TEST_NAME)');
          console.log('Expected: $(EXPECTED_BEHAVIOR)');
          console.log('Note: Custom path /custom/node/path does not exist, so fallback will be used');
          "@
          
          $taskScript | Out-File -FilePath "$(Agent.TempDirectory)/test-custom-path.js" -Encoding UTF8

    - task: PowerShell@2
      displayName: 'Execute Custom Path Test'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "Executing custom path test (will fallback since path doesn't exist)..." -ForegroundColor Yellow
          node "$(Agent.TempDirectory)/test-custom-path.js"
          Write-Host "Custom path test completed. In real scenario, custom path would take priority." -ForegroundColor Green

  # =============================================================================
  # REAL AZURE DEVOPS TASKS INTEGRATION
  # =============================================================================
  
  - job: 'Real_AzDO_Tasks_Integration'
    displayName: 'Integration with Real Azure DevOps Tasks'
    dependsOn:
    - Node6_Handler_Tests
    - Node16_Handler_Tests  
    - Node20_Handler_Tests
    - Global_Knob_Tests
    - Custom_Node_Path_Tests
    
    variables:
      AGENT_ENABLE_EOL_NODE_VERSION_POLICY: 'true'
    
    steps:
    - task: PowerShell@2
      displayName: 'Setup Real Task Integration Test'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== Real Azure DevOps Tasks Integration Test ===" -ForegroundColor Cyan
          Write-Host "Testing EOL Node feature with actual Azure DevOps tasks" -ForegroundColor Yellow
          Write-Host "EOL Policy Enabled: $env:AGENT_ENABLE_EOL_NODE_VERSION_POLICY" -ForegroundColor Green

    # Test with NodeTool task (if available)
    - task: NodeTool@0
      displayName: 'Test NodeTool Task with Node 6.x'
      continueOnError: true
      inputs:
        versionSpec: '6.x'  # Should trigger EOL policy
        
    # Test with NPM task (if available)  
    - task: Npm@1
      displayName: 'Test NPM Task'
      continueOnError: true
      inputs:
        command: 'custom'
        customCommand: '--version'

    # Create package.json for NPM test
    - task: PowerShell@2
      displayName: 'Create package.json for NPM Test'
      inputs:
        targetType: 'inline'
        script: |
          $packageJson = @{
              "name" = "eol-node-test"
              "version" = "1.0.0"
              "scripts" = @{
                  "test" = "node --version"
              }
          } | ConvertTo-Json
          
          $packageJson | Out-File -FilePath "$(Build.SourcesDirectory)/package.json" -Encoding UTF8
          Write-Host "Created package.json for NPM testing"

    # Run NPM script to see which node gets used
    - task: Npm@1
      displayName: 'Run NPM Script Test'
      continueOnError: true
      inputs:
        command: 'custom'
        customCommand: 'run test'
        workingDir: '$(Build.SourcesDirectory)'

    - task: PowerShell@2
      displayName: 'Integration Test Results Analysis'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== Integration Test Analysis ===" -ForegroundColor Cyan
          Write-Host "Review the task logs above to verify:" -ForegroundColor Yellow
          Write-Host "‚Ä¢ Which node versions were selected by each task" -ForegroundColor White
          Write-Host "‚Ä¢ Whether EOL policy was applied correctly" -ForegroundColor White
          Write-Host "‚Ä¢ If agent logs show strategy selection messages" -ForegroundColor White
          Write-Host ""
          Write-Host "Expected behavior with EOL policy enabled:" -ForegroundColor Green
          Write-Host "‚Ä¢ Tasks requesting Node 6.x should use Node24/20 instead" -ForegroundColor Green
          Write-Host "‚Ä¢ NPM tasks should use current/supported Node versions" -ForegroundColor Green
          Write-Host "‚Ä¢ Agent should log strategy selection decisions" -ForegroundColor Green

# =============================================================================
# COMPREHENSIVE TEST RESULTS AND VALIDATION
# =============================================================================

- stage: 'Test_Results_Validation'
  displayName: 'Test Results and Validation'
  dependsOn: 'EOL_Node_Feature_Testing'
  condition: always()

  jobs:
  - job: 'Comprehensive_Results_Analysis'
    displayName: 'Comprehensive Test Results Analysis'
    
    steps:
    - task: PowerShell@2
      displayName: 'Generate Comprehensive Test Report'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "=== EOL Node.js Feature - Comprehensive Test Report ===" -ForegroundColor Cyan
          Write-Host ""
          
          Write-Host "üéØ Test Categories Executed:" -ForegroundColor Yellow
          Write-Host "‚úÖ Node6 Handler Tests (EOL Policy On/Off, Global Knobs)" -ForegroundColor Green
          Write-Host "‚úÖ Node16 Handler Tests (EOL Policy On/Off)" -ForegroundColor Green
          Write-Host "‚úÖ Node20 Handler Tests (Should not be affected)" -ForegroundColor Green
          Write-Host "‚úÖ Global Knob Override Tests (NODE24, NODE20_1, Priority)" -ForegroundColor Green
          Write-Host "‚úÖ Custom Node Path Tests (Highest Priority Override)" -ForegroundColor Green
          Write-Host "‚úÖ Real Azure DevOps Tasks Integration" -ForegroundColor Green
          Write-Host ""
          
          Write-Host "üìä Key Validation Points:" -ForegroundColor Magenta
          Write-Host "‚Ä¢ EOL Upgrade Behavior:" -ForegroundColor White
          Write-Host "  - Node6 + EOL Policy ON ‚Üí Node24" -ForegroundColor Gray
          Write-Host "  - Node16 + EOL Policy ON ‚Üí Node24" -ForegroundColor Gray
          Write-Host "  - Node6/16 + EOL Policy OFF ‚Üí Original versions" -ForegroundColor Gray
          Write-Host ""
          Write-Host "‚Ä¢ Global Knob Overrides:" -ForegroundColor White
          Write-Host "  - AGENT_USE_NODE24=true ‚Üí All tasks use Node24" -ForegroundColor Gray
          Write-Host "  - AGENT_USE_NODE20_1=true ‚Üí All tasks use Node20.1" -ForegroundColor Gray
          Write-Host "  - Multiple knobs ‚Üí Node24 wins (priority)" -ForegroundColor Gray
          Write-Host ""
          Write-Host "‚Ä¢ Priority Order Validation:" -ForegroundColor White
          Write-Host "  - Custom Node Path (highest)" -ForegroundColor Gray
          Write-Host "  - Global Knobs (NODE24 > NODE20_1)" -ForegroundColor Gray
          Write-Host "  - EOL Policy Upgrades" -ForegroundColor Gray
          Write-Host "  - Handler Data (lowest)" -ForegroundColor Gray
          Write-Host ""
          
          Write-Host "üîç How to Validate Results:" -ForegroundColor Cyan
          Write-Host "1. Check each job's 'Execute [Handler] Task' step logs" -ForegroundColor White
          Write-Host "2. Look for 'Node executable path' in the output" -ForegroundColor White  
          Write-Host "3. Verify the path matches expected node version" -ForegroundColor White
          Write-Host "4. Check agent logs for strategy selection messages" -ForegroundColor White
          Write-Host ""
          
          Write-Host "üìã Success Criteria Checklist:" -ForegroundColor Yellow
          Write-Host "‚ñ° Node6 with EOL policy shows node24 path" -ForegroundColor White
          Write-Host "‚ñ° Node16 with EOL policy shows node24 path" -ForegroundColor White
          Write-Host "‚ñ° Node6/16 without EOL policy show original paths" -ForegroundColor White
          Write-Host "‚ñ° Node20 tasks show node20_1 path (unaffected by EOL)" -ForegroundColor White
          Write-Host "‚ñ° AGENT_USE_NODE24 forces node24 for all tasks" -ForegroundColor White
          Write-Host "‚ñ° AGENT_USE_NODE20_1 forces node20_1 for all tasks" -ForegroundColor White
          Write-Host "‚ñ° Multiple knobs prioritize NODE24 over NODE20_1" -ForegroundColor White
          Write-Host "‚ñ° Custom path attempts to use custom location first" -ForegroundColor White
          Write-Host "‚ñ° Real Azure DevOps tasks respect EOL policy" -ForegroundColor White
          Write-Host ""
          
          Write-Host "üöÄ Next Steps:" -ForegroundColor Green
          Write-Host "1. Review individual job results above" -ForegroundColor White
          Write-Host "2. Validate node executable paths in task outputs" -ForegroundColor White
          Write-Host "3. Check agent diagnostic logs for selection strategy messages" -ForegroundColor White
          Write-Host "4. Test with additional real-world pipeline scenarios" -ForegroundColor White
          Write-Host "5. Verify container scenarios if using containerized builds" -ForegroundColor White
          Write-Host ""
          
          Write-Host "‚úÖ EOL Node.js Feature Testing Complete!" -ForegroundColor Green